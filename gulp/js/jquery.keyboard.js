!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";var t=e.keyboard=function(a,i){var s,n=this;n.version="1.25.27",n.$el=e(a),n.el=a,n.$el.data("keyboard",n),n.init=function(){var a,o,r,l=t.css,c=t.events;n.settings=i||{},i&&i.position&&(o=e.extend({},i.position),i.position=null),n.options=s=e.extend(!0,{},t.defaultOptions,i),o&&(s.position=o,i.position=o),n.el.active=!0,n.namespace=".keyboard"+Math.random().toString(16).slice(2),n.extensionNamespace=[],n.shiftActive=n.altActive=n.metaActive=n.sets=n.capsLock=!1,n.rows=["","-shift","-alt","-alt-shift"],n.inPlaceholder=n.$el.attr("placeholder")||"",n.watermark=t.watermark&&""!==n.inPlaceholder,n.repeatTime=1e3/(s.repeatRate||20),s.preventDoubleEventTime=s.preventDoubleEventTime||100,n.isOpen=!1,n.wheel=e.isFunction(e.fn.mousewheel),n.escapeRegex=/[-\/\\^$*+?.()|[\]{}]/g,a=t.keyCodes,n.alwaysAllowed=[a.capsLock,a.pageUp,a.pageDown,a.end,a.home,a.left,a.up,a.right,a.down,a.insert,a.delete],n.$keyboard=[],n.enabled=!0,e.isEmptyObject(s.position)||(s.position.orig_at=s.position.at),n.checkCaret=s.lockInput||t.checkCaretSupport(),n.last={start:0,end:0,key:"",val:"",preVal:"",layout:"",virtual:!0,keyset:[!1,!1,!1],wheel_$Keys:null,wheelIndex:0,wheelLayers:[]},n.temp=["",0,0],e.each([c.kbInit,c.kbBeforeVisible,c.kbVisible,c.kbHidden,c.inputCanceled,c.inputAccepted,c.kbBeforeClose],function(t,a){e.isFunction(s[a])&&n.$el.bind(a+n.namespace+"callbacks",s[a])}),s.alwaysOpen&&(s.stayOpen=!0),r=e(document),n.el.ownerDocument!==document&&(r=r.add(n.el.ownerDocument)),r.bind("mousedown keyup touchstart checkkeyboard ".split(" ").join(n.namespace+" "),n.checkClose),n.$el.addClass(l.input+" "+s.css.input).attr({"aria-haspopup":"true",role:"textbox"}),(s.lockInput||n.el.readOnly)&&(s.lockInput=!0,n.$el.addClass(l.locked).attr({readonly:"readonly"})),(n.$el.is(":disabled")||n.$el.attr("readonly")&&!n.$el.hasClass(l.locked))&&n.$el.addClass(l.noKeyboard),s.openOn&&n.bindFocus(),n.watermark||""!==n.$el.val()||""===n.inPlaceholder||""===n.$el.attr("placeholder")||n.$el.addClass(l.placeholder).val(n.inPlaceholder),n.$el.trigger(c.kbInit,[n,n.el]),s.alwaysOpen&&n.reveal()},n.toggle=function(){var e=n.$keyboard.find("."+t.css.keyToggle),a=!n.enabled;n.$preview.prop("readonly",a||n.options.lockInput),n.$keyboard.toggleClass(t.css.keyDisabled,a).find("."+t.css.keyButton).not(e).prop("disabled",a).attr("aria-disabled",a),e.toggleClass(t.css.keyDisabled,a),a&&n.typing_options&&(n.typing_options.text="")},n.setCurrent=function(){var a=t.css,i=e("."+a.isCurrent),s=i.data("keyboard");e.isEmptyObject(s)||s.el===n.el||s.close(!!s.options.autoAccept&&"true"),i.removeClass(a.isCurrent),e("."+a.hasFocus).removeClass(a.hasFocus),n.$el.addClass(a.isCurrent),n.$keyboard.addClass(a.hasFocus),n.isCurrent(!0),n.isOpen=!0},n.isCurrent=function(e){var a=t.currentKeyboard||!1;return e?a=t.currentKeyboard=n.el:e===!1&&a===n.el&&(a=t.currentKeyboard=""),a===n.el},n.isVisible=function(){return!(!n.$keyboard||!n.$keyboard.length)&&n.$keyboard.is(":visible")},n.focusOn=function(){!n&&n.el.active||n.isVisible()||(clearTimeout(n.timer),n.reveal())},n.redraw=function(){n.$keyboard.length&&(n.last.preVal=""+n.last.val,n.last.val=n.$preview&&n.$preview.val()||n.$el.val(),n.$el.val(n.last.val),n.removeKeyboard(),n.shiftActive=n.altActive=n.metaActive=!1),n.isOpen=s.alwaysOpen,n.reveal(!0)},n.reveal=function(a){var i=n.isOpen,o=t.css;return n.opening=!i,e("."+o.keyboard).not("."+o.alwaysOpen).each(function(){var t=e(this).data("keyboard");e.isEmptyObject(t)||t.close(!(!t.options.autoAccept||!t.options.autoAcceptOnEsc)&&"true")}),n.$el.is(":disabled")||n.$el.attr("readonly")&&!n.$el.hasClass(o.locked)?void n.$el.addClass(o.noKeyboard):(n.$el.removeClass(o.noKeyboard),s.openOn&&n.$el.unbind(e.trim((s.openOn+" ").split(/\s+/).join(n.namespace+" "))),n.$keyboard&&(!n.$keyboard||n.$keyboard.length&&!e.contains(document.body,n.$keyboard[0]))||n.startup(),n.watermark||n.el.value!==n.inPlaceholder||n.$el.removeClass(o.placeholder).val(""),n.originalContent=n.$el.val(),n.$preview.val(n.originalContent),s.acceptValid&&n.checkValid(),s.resetDefault&&(n.shiftActive=n.altActive=n.metaActive=!1),n.showSet(),n.isVisible()||n.$el.trigger(t.events.kbBeforeVisible,[n,n.el]),n.setCurrent(),n.toggle(),n.$keyboard.show(),s.usePreview&&t.msie&&("undefined"==typeof n.width&&(n.$preview.hide(),n.width=Math.ceil(n.$keyboard.width()),n.$preview.show()),n.$preview.width(n.width)),n.position=!e.isEmptyObject(s.position)&&s.position,e.ui&&e.ui.position&&n.position&&(n.position.of=n.position.of||n.$el.data("keyboardPosition")||n.$el,n.position.collision=n.position.collision||"flipfit flipfit",s.position.at=s.usePreview?s.position.orig_at:s.position.at2,n.$keyboard.position(n.position)),n.checkDecimal(),n.lineHeight=parseInt(n.$preview.css("lineHeight"),10)||parseInt(n.$preview.css("font-size"),10)+4,s.caretToEnd&&n.saveCaret(n.originalContent.length,n.originalContent.length),t.allie&&(0===n.last.end&&n.last.start>0&&(n.last.end=n.last.start),n.last.start<0&&(n.last.start=n.last.end=n.originalContent.length)),i||a?(t.caret(n.$preview,n.last),n):(n.timer2=setTimeout(function(){var e;n.opening=!1,/(number|email)/i.test(n.el.type)||s.caretToEnd||n.saveCaret(e,e,n.$el),s.initialFocus&&t.caret(n.$preview,n.last),n.last.eventTime=(new Date).getTime(),n.$el.trigger(t.events.kbVisible,[n,n.el]),n.timer=setTimeout(function(){n&&n.saveCaret()},200)},10),n))},n.updateLanguage=function(){var a=t.layouts,i=s.language||a[s.layout]&&a[s.layout].lang&&a[s.layout].lang||[s.language||"en"],o=t.language;i=(e.isArray(i)?i[0]:i).split("-")[0],s.display=e.extend(!0,{},o.en.display,o[i]&&o[i].display||{},n.settings.display),s.combos=e.extend(!0,{},o.en.combos,o[i]&&o[i].combos||{},n.settings.combos),s.wheelMessage=o[i]&&o[i].wheelMessage||o.en.wheelMessage,s.rtl=a[s.layout]&&a[s.layout].rtl||o[i]&&o[i].rtl||!1,n.regex=o[i]&&o[i].comboRegex||t.comboRegex,n.decimal=/^\./.test(s.display.dec),n.$el.toggleClass("rtl",s.rtl).css("direction",s.rtl?"rtl":"")},n.startup=function(){var a=t.css;(s.alwaysOpen||s.userClosed)&&n.$preview||n.makePreview(),n.$keyboard&&n.$keyboard.length||("custom"===s.layout&&(s.layoutHash="custom"+n.customHash()),n.layout="custom"===s.layout?s.layoutHash:s.layout,n.last.layout=n.layout,n.updateLanguage(),"undefined"==typeof t.builtLayouts[n.layout]&&(e.isFunction(s.create)?n.$keyboard=s.create(n):n.$keyboard.length||n.buildKeyboard(n.layout,!0)),n.$keyboard=t.builtLayouts[n.layout].$keyboard.clone(),n.$keyboard.data("keyboard",n),""!==(n.el.id||"")&&n.$keyboard.attr("id",n.el.id+t.css.idSuffix),n.makePreview(),s.usePreview?e.isEmptyObject(s.position)||(s.position.at=s.position.orig_at):e.isEmptyObject(s.position)||(s.position.at=s.position.at2)),n.$decBtn=n.$keyboard.find("."+a.keyPrefix+"dec"),(s.enterNavigation||"TEXTAREA"===n.el.nodeName)&&n.alwaysAllowed.push(13),n.bindKeyboard(),n.$keyboard.appendTo(s.appendLocally?n.$el.parent():s.appendTo||"body"),n.bindKeys(),s.reposition&&e.ui&&e.ui.position&&"body"==s.appendTo&&e(window).bind("resize"+n.namespace,function(){n.position&&n.isVisible()&&n.$keyboard.position(n.position)})},n.makePreview=function(){if(s.usePreview){var a,i,o,r,l=t.css;for(n.$preview=n.$el.clone(!1).data("keyboard",n).removeClass(l.placeholder+" "+l.input).addClass(l.preview+" "+s.css.input).attr("tabindex","-1").show(),n.preview=n.$preview[0],"number"===n.preview.type&&(n.preview.type="text"),r=/^(data-|id|aria-haspopup)/i,i=n.$preview.get(0).attributes,a=i.length-1;a>=0;a--)o=i[a]&&i[a].name,r.test(o)&&n.preview.removeAttribute(o);e("<div />").addClass(l.wrapper).append(n.$preview).prependTo(n.$keyboard)}else n.$preview=n.$el,n.preview=n.el},n.saveCaret=function(e,a,i){var s=t.caret(i||n.$preview,e,a);n.last.start="undefined"==typeof e?s.start:e,n.last.end="undefined"==typeof a?s.end:a},n.setScroll=function(){if(n.last.virtual){var e,a,i,o,r="TEXTAREA"===n.preview.nodeName,l=n.last.val.substring(0,Math.max(n.last.start,n.last.end));n.$previewCopy||(n.$previewCopy=n.$preview.clone().removeAttr("id").css({position:"absolute",left:0,zIndex:-10,visibility:"hidden"}).addClass(t.css.inputClone),r||n.$previewCopy.css({"white-space":"pre",width:0}),s.usePreview?n.$preview.after(n.$previewCopy):n.$keyboard.prepend(n.$previewCopy)),r?(n.$previewCopy.height(n.lineHeight).val(l),n.preview.scrollTop=n.lineHeight*(Math.floor(n.$previewCopy[0].scrollHeight/n.lineHeight)-1)):(n.$previewCopy.val(l.replace(/\s/g," ")),i=/c/i.test(s.scrollAdjustment)?n.preview.clientWidth/2:s.scrollAdjustment,e=n.$previewCopy[0].scrollWidth-1,"undefined"==typeof n.last.scrollWidth&&(n.last.scrollWidth=e,n.last.direction=!0),o=n.last.scrollWidth===e?n.last.direction:n.last.scrollWidth<e,a=n.preview.clientWidth-i,o?e<a?n.preview.scrollLeft=0:n.preview.scrollLeft=e-a:e>=n.preview.scrollWidth-a?n.preview.scrollLeft=n.preview.scrollWidth-i:e-i>0?n.preview.scrollLeft=e-i:n.preview.scrollLeft=0,n.last.scrollWidth=e,n.last.direction=o)}},n.bindFocus=function(){s.openOn&&n&&n.el.active&&(n.$el.bind(s.openOn+n.namespace,function(){n.focusOn()}),e(":focus")[0]===n.el&&n.$el.blur())},n.bindKeyboard=function(){var a,i=t.keyCodes,o=t.builtLayouts[n.layout];n.$preview.unbind(n.namespace).bind("click"+n.namespace+" touchstart"+n.namespace,function(){s.alwaysOpen&&!n.isCurrent()&&n.reveal(),n.timer2=setTimeout(function(){n&&n.saveCaret()},150)}).bind("keypress"+n.namespace,function(r){if(s.lockInput)return!1;var l=r.charCode||r.which,c=l>=i.A&&l<=i.Z,d=l>=i.a&&l<=i.z,p=n.last.key=String.fromCharCode(l);if(n.last.virtual=!1,n.last.event=r,n.last.$key=[],n.checkCaret&&n.saveCaret(),l!==i.capsLock&&(c||d)&&(n.capsLock=c&&!r.shiftKey||d&&r.shiftKey,n.capsLock&&!n.shiftActive&&(n.shiftActive=!0,n.showSet())),s.restrictInput){if((r.which===i.backSpace||0===r.which)&&e.inArray(r.keyCode,n.alwaysAllowed))return;e.inArray(p,o.acceptedKeys)===-1&&(r.preventDefault(),a=e.extend({},r),a.type=t.events.inputRestricted,n.$el.trigger(a,[n,n.el]),e.isFunction(s.restricted)&&s.restricted(a,n,n.el))}else if((r.ctrlKey||r.metaKey)&&(r.which===i.A||r.which===i.C||r.which===i.V||r.which>=i.X&&r.which<=i.Z))return;o.hasMappedKeys&&o.mappedKeys.hasOwnProperty(p)&&(n.last.key=o.mappedKeys[p],n.insertText(n.last.key),r.preventDefault()),n.checkMaxLength()}).bind("keyup"+n.namespace,function(a){switch(n.last.virtual=!1,a.which){case i.tab:if(n.tab&&s.tabNavigation&&!s.lockInput){n.shiftActive=a.shiftKey;var o=t.keyaction.tab(n);if(n.tab=!1,!o)return!1}else a.preventDefault();break;case i.escape:return s.ignoreEsc||n.close(!(!s.autoAccept||!s.autoAcceptOnEsc)&&"true"),!1}if(clearTimeout(n.throttled),n.throttled=setTimeout(function(){n&&n.isVisible()&&n.checkCombos()},100),n.checkMaxLength(),n.last.preVal=""+n.last.val,n.last.val=n.$preview.val(),a.type=t.events.kbChange,a.action=n.last.key,n.$el.trigger(a,[n,n.el]),e.isFunction(s.change))return a.type=t.events.inputChange,s.change(a,n,n.el),!1}).bind("keydown"+n.namespace,function(e){if(s.alwaysOpen&&!n.isCurrent()&&n.reveal(),e.which===i.tab)return n.tab=!0,!1;if(s.lockInput)return!1;switch(n.last.virtual=!1,e.which){case i.backSpace:t.keyaction.bksp(n,null,e),e.preventDefault();break;case i.enter:t.keyaction.enter(n,null,e);break;case i.capsLock:n.shiftActive=n.capsLock=!n.capsLock,n.showSet();break;case i.V:if(e.ctrlKey||e.metaKey){if(s.preventPaste)return void e.preventDefault();n.checkCombos()}}}).bind("mouseup touchend ".split(" ").join(n.namespace+" "),function(){n.last.virtual=!0,n.saveCaret()}),n.$keyboard.bind("mousedown click touchstart ".split(" ").join(n.namespace+" "),function(t){t.stopPropagation(),n.isCurrent()||(n.reveal(),e(document).trigger("checkkeyboard"+n.namespace)),s.noFocus||n.$preview.focus()}),s.preventPaste&&(n.$preview.bind("contextmenu"+n.namespace,function(e){e.preventDefault()}),n.$el.bind("contextmenu"+n.namespace,function(e){e.preventDefault()}))},n.bindKeys=function(){var a=t.css;n.$allKeys=n.$keyboard.find("button."+a.keyButton).unbind(n.namespace+" "+n.namespace+"kb").bind("mouseenter mouseleave touchstart ".split(" ").join(n.namespace+" "),function(a){if(!s.alwaysOpen&&!s.userClosed||"mouseleave"===a.type||n.isCurrent()||(n.reveal(),n.$preview.focus(),t.caret(n.$preview,n.last)),n.isCurrent()){var i,o,r=n.last,l=e(this),c=a.type;s.useWheel&&n.wheel&&(i=n.getLayers(l),o=(i.length?i.map(function(){return e(this).attr("data-value")||""}).get():"")||[l.text()],r.wheel_$Keys=i,r.wheelLayers=o,r.wheelIndex=e.inArray(l.attr("data-value"),o)),"mouseenter"!==c&&"touchstart"!==c||"password"===n.el.type||l.hasClass(s.css.buttonDisabled)||(l.addClass(s.css.buttonHover),s.useWheel&&n.wheel&&l.attr("title",function(e,t){return n.wheel&&""===t&&n.sets&&o.length>1&&"touchstart"!==c?s.wheelMessage:t})),"mouseleave"===c&&(l.removeClass("password"===n.el.type?"":s.css.buttonHover),s.useWheel&&n.wheel&&(r.wheelIndex=0,r.wheelLayers=[],r.wheel_$Keys=null,l.attr("title",function(e,t){return t===s.wheelMessage?"":t}).html(l.attr("data-html"))))}}).bind(s.keyBinding.split(" ").join(n.namespace+" ")+n.namespace+" "+t.events.kbRepeater,function(i){if(i.preventDefault(),!n.$keyboard.is(":visible"))return!1;var o,r,l=n.last,c=this,d=e(c),p=(new Date).getTime();if(s.useWheel&&n.wheel&&(r=l.wheel_$Keys,d=r&&l.wheelIndex>-1?r.eq(l.wheelIndex):d),o=d.attr("data-action"),!(p-(l.eventTime||0)<s.preventDoubleEventTime)){if(l.eventTime=p,l.event=i,l.virtual=!0,s.noFocus||n.$preview.focus(),l.$key=d,l.key=d.attr("data-value"),n.checkCaret&&t.caret(n.$preview,l),o.match("meta")&&(o="meta"),o===l.key&&"string"==typeof t.keyaction[o])l.key=o=t.keyaction[o];else if(o in t.keyaction&&e.isFunction(t.keyaction[o])){if(t.keyaction[o](n,this,i)===!1)return!1;o=null}return"undefined"!=typeof o&&null!==o&&(l.key=e(this).hasClass(a.keyAction)?o:l.key,n.insertText(l.key),n.capsLock||s.stickyShift||i.shiftKey||(n.shiftActive=!1,n.showSet(d.attr("data-name")))),t.caret(n.$preview,l),n.checkCombos(),i.type=t.events.kbChange,i.action=l.key,n.$el.trigger(i,[n,n.el]),l.preVal=""+l.val,l.val=n.$preview.val(),e.isFunction(s.change)?(i.type=t.events.inputChange,s.change(i,n,n.el),!1):void 0}}).bind("mouseup"+n.namespace+" "+"mouseleave touchend touchmove touchcancel ".split(" ").join(n.namespace+"kb "),function(a){n.last.virtual=!0;var i,o=e(this);if("touchmove"===a.type){if(i=o.offset(),i.right=i.left+o.outerWidth(),i.bottom=i.top+o.outerHeight(),a.originalEvent.touches[0].pageX>=i.left&&a.originalEvent.touches[0].pageX<i.right&&a.originalEvent.touches[0].pageY>=i.top&&a.originalEvent.touches[0].pageY<i.bottom)return!0}else/(mouseleave|touchend|touchcancel)/i.test(a.type)?o.removeClass(s.css.buttonHover):(!s.noFocus&&n.isVisible()&&n.isCurrent()&&n.$preview.focus(),n.checkCaret&&t.caret(n.$preview,n.last));return n.mouseRepeat=[!1,""],clearTimeout(n.repeater),!1}).bind("click"+n.namespace,function(){return!1}).not("."+a.keyAction).bind("mousewheel"+n.namespace,function(t,a){if(s.useWheel&&n.wheel){a=a||t.deltaY;var i,o=n.last.wheelLayers||[];return o.length>1?(i=n.last.wheelIndex+(a>0?-1:1),i>o.length-1&&(i=0),i<0&&(i=o.length-1)):i=0,n.last.wheelIndex=i,e(this).html(o[i]),!1}}).add("."+a.keyPrefix+"tab bksp space enter".split(" ").join(",."+a.keyPrefix),n.$keyboard).bind("mousedown touchstart ".split(" ").join(n.namespace+"kb "),function(){if(0!==s.repeatRate){var t=e(this);n.mouseRepeat=[!0,t],setTimeout(function(){n&&n.mouseRepeat[0]&&n.mouseRepeat[1]===t&&!t[0].disabled&&n.repeatKey(t)},s.repeatDelay)}return!1})},n.insertText=function(e){if("undefined"!=typeof e){var a,i,s="\b"===e,o=n.$preview.val(),r=t.caret(n.$preview),l=o.length;r.end<r.start&&(r.end=r.start),r.start>l&&(r.end=r.start=l),"TEXTAREA"===n.preview.nodeName&&t.msie&&"\n"===o.substr(r.start,1)&&(r.start+=1,r.end+=1),"{d}"===e&&(e="",i=r.start,r.end+=1),a=s&&r.start===r.end,e=s?"":e,o=o.substr(0,r.start-(a?1:0))+e+o.substr(r.end),i=r.start+(a?-1:e.length),n.$preview.val(o),n.saveCaret(i,i),n.setScroll()}},n.checkMaxLength=function(){var e,a,i=n.$preview.val();s.maxLength!==!1&&i.length>s.maxLength&&(e=t.caret(n.$preview).start,a=Math.min(e,s.maxLength),s.maxInsert||(i=n.last.val,a=e-1),n.$preview.val(i.substring(0,s.maxLength)),n.saveCaret(a,a)),n.$decBtn.length&&n.checkDecimal()},n.repeatKey=function(e){e.trigger(t.events.kbRepeater),n.mouseRepeat[0]&&(n.repeater=setTimeout(function(){n&&n.repeatKey(e)},n.repeatTime))},n.showKeySet=function(e){"string"==typeof e?(n.last.keyset=[n.shiftActive,n.altActive,n.metaActive],n.shiftActive=/shift/i.test(e),n.altActive=/alt/i.test(e),/meta/.test(e)?(n.metaActive=!0,n.showSet(e.match(/meta\d+/i)[0])):(n.metaActive=!1,n.showSet())):n.showSet(e)},n.showSet=function(e){s=n.options;var a=t.css,i="."+a.keyPrefix,o=s.css.buttonActive,r="",l=(n.shiftActive?1:0)+(n.altActive?2:0);return n.shiftActive||(n.capsLock=!1),n.metaActive?(r=/meta/i.test(e)?e:"",""===r?r=n.metaActive===!0?"":n.metaActive:n.metaActive=r,(!s.stickyShift&&n.last.keyset[2]!==n.metaActive||(n.shiftActive||n.altActive)&&!n.$keyboard.find("."+a.keySet+"-"+r+n.rows[l]).length)&&(n.shiftActive=n.altActive=!1)):!s.stickyShift&&n.last.keyset[2]!==n.metaActive&&n.shiftActive&&(n.shiftActive=n.altActive=!1),l=(n.shiftActive?1:0)+(n.altActive?2:0),r=0!==l||n.metaActive?""===r?"":"-"+r:"-normal",n.$keyboard.find("."+a.keySet+r+n.rows[l]).length?(n.$keyboard.find(i+"alt,"+i+"shift,."+a.keyAction+"[class*=meta]").removeClass(o).end().find(i+"alt").toggleClass(o,n.altActive).end().find(i+"shift").toggleClass(o,n.shiftActive).end().find(i+"lock").toggleClass(o,n.capsLock).end().find("."+a.keySet).hide().end().find("."+a.keyAction+i+r).addClass(o),n.$keyboard.find("."+a.keySet+r+n.rows[l])[0].style.display="inline-block",n.metaActive&&n.$keyboard.find(i+n.metaActive).toggleClass(o,n.metaActive!==!1),n.last.keyset=[n.shiftActive,n.altActive,n.metaActive],void n.$el.trigger(t.events.kbKeysetChange,[n,n.el])):(n.shiftActive=n.last.keyset[0],n.altActive=n.last.keyset[1],void(n.metaActive=n.last.keyset[2]))},n.checkCombos=function(){if(!n.isVisible()&&!n.$keyboard.hasClass(t.css.hasFocus))return n.$preview.val();var a,i,o,r=n.$preview.val(),l=t.caret(n.$preview),c=t.builtLayouts[n.layout],d=r.length;return""===r?(s.acceptValid&&n.checkValid(),r):(l.end<l.start&&(l.end=l.start),l.start>d&&(l.end=l.start=d),t.msie&&"\n"===r.substr(l.start,1)&&(l.start+=1,l.end+=1),s.useCombos&&(t.msie?r=r.replace(n.regex,function(e,t,a){return s.combos.hasOwnProperty(t)?s.combos[t][a]||e:e}):n.$preview.length&&(i=l.start-(l.start-2>=0?2:0),t.caret(n.$preview,i,l.end),o=(t.caret(n.$preview).text||"").replace(n.regex,function(e,t,a){return s.combos.hasOwnProperty(t)?s.combos[t][a]||e:e}),n.$preview.val(t.caret(n.$preview).replaceStr(o)),r=n.$preview.val())),s.restrictInput&&""!==r&&(i=c.acceptedKeys.length,a=c.acceptedKeysRegex,a||(o=e.map(c.acceptedKeys,function(e){return e.replace(n.escapeRegex,"\\$&")}),a=c.acceptedKeysRegex=new RegExp("("+o.join("|")+")","g")),o=r.match(a),o?r=o.join(""):(r="",d=0)),l.start+=r.length-d,l.end+=r.length-d,n.$preview.val(r),n.saveCaret(l.start,l.end),n.setScroll(),n.checkMaxLength(),s.acceptValid&&n.checkValid(),r)},n.checkValid=function(){var a=t.css,i=n.$keyboard.find("."+a.keyPrefix+"accept"),o=!0;e.isFunction(s.validate)&&(o=s.validate(n,n.$preview.val(),!1)),i.toggleClass(a.inputInvalid,!o).toggleClass(a.inputValid,o).attr("title",i.attr("data-title")+" ("+s.display[o?"valid":"invalid"]+")")},n.checkDecimal=function(){n.decimal&&/\./g.test(n.preview.value)||!n.decimal&&/\,/g.test(n.preview.value)?n.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(s.css.buttonHover).addClass(s.css.buttonDisabled):n.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(s.css.buttonDefault).removeClass(s.css.buttonDisabled)},n.getLayers=function(a){var i=t.css,s=a.attr("data-pos"),n=a.closest("."+i.keyboard).find('button[data-pos="'+s+'"]');return n.filter(function(){return""!==e(this).find("."+i.keyText).text()}).add(a)},n.switchInput=function(t,a){if(e.isFunction(s.switchInput))s.switchInput(n,t,a);else{n.$keyboard.length&&n.$keyboard.hide();var i,o=!1,r=e("button, input, textarea, a").filter(":visible").not(":disabled"),l=r.index(n.$el)+(t?1:-1);if(n.$keyboard.length&&n.$keyboard.show(),l>r.length-1&&(o=s.stopAtEnd,l=0),l<0&&(o=s.stopAtEnd,l=r.length-1),!o){if(a=n.close(a),!a)return;i=r.eq(l).data("keyboard"),i&&i.options.openOn.length?i.focusOn():r.eq(l).focus()}}return!1},n.close=function(a){if(n.isOpen&&n.$keyboard.length){clearTimeout(n.throttled);var i=t.css,o=t.events,r=a?n.checkCombos():n.originalContent;if(a&&e.isFunction(s.validate)&&!s.validate(n,r,!0)&&(r=n.originalContent,a=!1,s.cancelClose))return;n.isCurrent(!1),n.isOpen=s.alwaysOpen||s.userClosed,n.$preview.val(r),n.$el.removeClass(i.isCurrent+" "+i.inputAutoAccepted).addClass(a?a===!0?"":i.inputAutoAccepted:"").val(r).trigger(o.inputChange).trigger(s.alwaysOpen?"":o.kbBeforeClose,[n,n.el,a||!1]).trigger(a?o.inputAccepted:o.inputCanceled,[n,n.el]).trigger(s.alwaysOpen?o.kbInactive:o.kbHidden,[n,n.el]).blur(),t.caret(n.$preview,n.last),n&&(n.last.eventTime=(new Date).getTime(),s.alwaysOpen||s.userClosed&&"true"===a||!n.$keyboard.length||(n.removeKeyboard(),n.timer=setTimeout(function(){n&&n.bindFocus()},500)),n.watermark||""!==n.el.value||""===n.inPlaceholder||n.$el.addClass(i.placeholder).val(n.inPlaceholder))}return!!a},n.accept=function(){return n.close(!0)},n.checkClose=function(t){if(!n.opening){n.escClose(t);var a=e.keyboard.css,i=e(t.target);if(i.hasClass(a.input)){var s=i.data("keyboard");s!==n||s.$el.hasClass(a.isCurrent)||t.type!==s.options.openOn||s.focusOn()}}},n.escClose=function(a){if(a&&"keyup"===a.type)return a.which!==t.keyCodes.escape||s.ignoreEsc?"":n.close(!(!s.autoAccept||!s.autoAcceptOnEsc)&&"true");if(n.isOpen&&(!n.isCurrent()&&n.isOpen||n.isOpen&&a.target!==n.el)){if((s.stayOpen||s.userClosed)&&!e(a.target).hasClass(t.css.input))return;t.allie&&a.preventDefault(),n.close(!!s.autoAccept&&"true")}},n.keyBtn=e("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass(t.css.keyButton),n.processName=function(e){var t,a,i=(e||"").replace(/[^a-z0-9-_]/gi,""),s=i.length,n=[];if(s>1&&e===i)return e;if(s=e.length){for(t=0;t<s;t++)a=e[t],n.push(/[a-z0-9-_]/i.test(a)?/[-_]/.test(a)&&0!==t?"":a:(0===t?"":"-")+a.charCodeAt(0));return n.join("")}return e},n.processKeys=function(t){var a,i=t.split(":"),s={name:null,map:"",title:""};return/\(.+\)/.test(i[0])||/^:\(.+\)/.test(t)||/\([(:)]\)/.test(t)?/\([(:)]\)/.test(t)?(a=i[0].match(/([^(]+)\((.+)\)/),a&&a.length?(s.name=a[1],s.map=a[2],s.title=i.length>1?i.slice(1).join(":"):""):(s.name=t.match(/([^(]+)/)[0],":"===s.name&&(i=i.slice(1)),null===a&&(s.map=":",i=i.slice(2)),s.title=i.length?i.join(":"):"")):(s.map=t.match(/\(([^()]+?)\)/)[1],t=t.replace(/\(([^()]+)\)/,""),a=t.split(":"),""===a[0]?(s.name=":",i=i.slice(1)):s.name=a[0],s.title=i.length>1?i.slice(1).join(":"):""):(""===i[0]?(s.name=":",i=i.slice(1)):s.name=i[0],s.title=i.length>1?i.slice(1).join(":"):""),s.title=e.trim(s.title).replace(/_/g," "),s},n.addKey=function(e,a,i){var o,r,l,c={},d=n.processKeys(i?e:a),p=t.css;return!i&&s.display[d.name]?(l=n.processKeys(s.display[d.name]),l.action=n.processKeys(e).name):(l=d,l.action=d.name),c.name=n.processName(d.name),""!==l.map?(t.builtLayouts[n.layout].mappedKeys[l.map]=l.name,t.builtLayouts[n.layout].acceptedKeys.push(l.name)):i&&t.builtLayouts[n.layout].acceptedKeys.push(l.name),o=i?""===c.name?"":p.keyPrefix+c.name:p.keyAction+" "+p.keyPrefix+l.action,o+=(l.name.length>2?" "+p.keyWide:"")+" "+s.css.buttonDefault,c.html='<span class="'+p.keyText+'">'+l.name.replace(/[\u00A0-\u9999]/gim,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",c.$key=n.keyBtn.clone().attr({"data-value":i?l.name:l.action,"data-name":l.action,"data-pos":n.temp[1]+","+n.temp[2],"data-action":l.action,"data-html":c.html}).addClass(o).html(c.html).appendTo(n.temp[0]),l.map&&c.$key.attr("data-mapped",l.map),(l.title||d.title)&&c.$key.attr({"data-title":d.title||l.title,title:d.title||l.title}),"function"==typeof s.buildKey&&(c=s.buildKey(n,c),r=c.$key.html(),c.$key.attr("data-html",r)),c.$key},n.customHash=function(e){var t,a,i,n,o,r=[],l=[];e="undefined"==typeof e?s.customLayout:e;for(a in e)e.hasOwnProperty(a)&&r.push(e[a]);if(l=l.concat.apply(l,r).join(" "),i=0,o=l.length,0===o)return i;for(t=0;t<o;t++)n=l.charCodeAt(t),i=(i<<5)-i+n,i&=i;return i},n.buildKeyboard=function(a,i){e.isEmptyObject(s.display)&&n.updateLanguage();var o,r,l,c=t.css,d=0,p=t.builtLayouts[a||n.layout||s.layout]={mappedKeys:{},acceptedKeys:[]},u=p.acceptedKeys=s.restrictInclude?(""+s.restrictInclude).split(/\s+/)||[]:[],y=c.keyboard+" "+s.css.popup+" "+s.css.container+(s.alwaysOpen||s.userClosed?" "+c.alwaysOpen:""),h=e("<div />").addClass(y).attr({role:"textbox"}).hide();return i&&"custom"===s.layout||!t.layouts.hasOwnProperty(s.layout)?(s.layout="custom",y=t.layouts.custom=s.customLayout||{normal:["{cancel}"]}):y=t.layouts[i?s.layout:a||n.layout||s.layout],e.each(y,function(t,a){if(""!==t&&!/^(name|lang|rtl)$/i.test(t))for("default"===t&&(t="normal"),d++,r=e("<div />").attr("name",t).addClass(c.keySet+" "+c.keySet+"-"+t).appendTo(h).toggle("normal"===t),o=0;o<a.length;o++)l=e.trim(a[o]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}"),n.buildRow(r,o,l.split(/\s+/),u),r.find("."+c.keyButton+",."+c.keySpacer).filter(":last").after('<br class="'+c.endRow+'"/>')}),d>1&&(n.sets=!0),p.hasMappedKeys=!e.isEmptyObject(p.mappedKeys),p.$keyboard=h,h},n.buildRow=function(a,i,o,r){var l,c,d,p,u,y,h=t.css;for(d=0;d<o.length;d++)if(n.temp=[a,i,d],p=!1,0!==o[d].length)if(/^\{\S+\}$/.test(o[d])){if(u=o[d].match(/^\{(\S+)\}$/)[1],/\!\!/.test(u)&&(u=u.replace("!!",""),p=!0),/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i.test(u)&&(y=parseFloat(u.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0),e('<span class="'+h.keyText+'"></span>').width(u.match(/px/i)?y+"px":2*y+"em").addClass(h.keySpacer).appendTo(a)),/^empty(:((\d+)?([\.|,]\d+)?)(em|px)?)?$/i.test(u)&&(y=/:/.test(u)?parseFloat(u.replace(/,/,".").match(/^empty:((\d+)?([\.|,]\d+)?)(em|px)?$/i)[1]||0):"",n.addKey(""," ").addClass(s.css.buttonDisabled+" "+s.css.buttonEmpty).attr("aria-disabled",!0).width(y?u.match("px")?y+"px":2*y+"em":"")),/^meta\d+\:?(\w+)?/i.test(u)){n.addKey(u.split(":")[0],u).addClass(h.keyHasActive);continue}switch(c=u.split(":"),c[0].toLowerCase()){case"a":case"accept":n.addKey("accept",u).addClass(s.css.buttonAction+" "+h.keyAction);break;case"alt":case"altgr":n.addKey("alt",u).addClass(h.keyHasActive);break;case"b":case"bksp":n.addKey("bksp",u);break;case"c":case"cancel":n.addKey("cancel",u).addClass(s.css.buttonAction+" "+h.keyAction);break;case"combo":n.addKey("combo",u).addClass(h.keyHasActive).attr("title",function(e,t){return t+" "+s.display[s.useCombos?"active":"disabled"]}).toggleClass(s.css.buttonActive,s.useCombos);break;case"dec":r.push(n.decimal?".":","),n.addKey("dec",u);break;case"e":case"enter":n.addKey("enter",u).addClass(s.css.buttonAction+" "+h.keyAction);break;case"lock":n.addKey("lock",u).addClass(h.keyHasActive);break;case"s":case"shift":n.addKey("shift",u).addClass(h.keyHasActive);break;case"sign":r.push("-"),n.addKey("sign",u);break;case"space":r.push(" "),n.addKey("space",u);break;case"t":case"tab":n.addKey("tab",u);break;default:t.keyaction.hasOwnProperty(c[0])&&n.addKey(c[0],u).toggleClass(s.css.buttonAction+" "+h.keyAction,p)}}else l=o[d],n.addKey(l,l,!0)},n.removeBindings=function(t){e(document).unbind(t),n.el.ownerDocument!==document&&e(n.el.ownerDocument).unbind(t),e(window).unbind(t),n.$el.unbind(t)},n.removeKeyboard=function(){n.$allKeys=null,n.$decBtn=null,s.usePreview&&n.$preview.removeData("keyboard"),n.preview=null,n.$preview=null,n.$previewCopy=null,n.$keyboard.removeData("keyboard"),n.$keyboard.remove(),n.$keyboard=[],n.isOpen=!1,n.isCurrent(!1)},n.destroy=function(e){var a,i=t.css,o=n.extensionNamespace.length,r=[i.input,i.locked,i.placeholder,i.noKeyboard,i.alwaysOpen,s.css.input,i.isCurrent].join(" ");for(clearTimeout(n.timer),clearTimeout(n.timer2),n.$keyboard.length&&n.removeKeyboard(),n.removeBindings(n.namespace),n.removeBindings(n.namespace+"callbacks"),a=0;a<o;a++)n.removeBindings(n.extensionNamespace[a]);n.el.active=!1,n.$el.removeClass(r).removeAttr("aria-haspopup").removeAttr("role").removeData("keyboard"),n=null,"function"==typeof e&&e()},n.init()};return t.keyCodes={backSpace:8,tab:9,enter:13,capsLock:20,escape:27,space:32,pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,A:65,Z:90,V:86,C:67,X:88,a:97,z:122},t.css={idSuffix:"_keyboard",input:"ui-keyboard-input",inputClone:"ui-keyboard-preview-clone",wrapper:"ui-keyboard-preview-wrapper",preview:"ui-keyboard-preview",keyboard:"ui-keyboard",keySet:"ui-keyboard-keyset",keyButton:"ui-keyboard-button",keyWide:"ui-keyboard-widekey",keyPrefix:"ui-keyboard-",keyText:"ui-keyboard-text",keyHasActive:"ui-keyboard-hasactivestate",keyAction:"ui-keyboard-actionkey",keySpacer:"ui-keyboard-spacer",keyToggle:"ui-keyboard-toggle",keyDisabled:"ui-keyboard-disabled",locked:"ui-keyboard-lockedinput",alwaysOpen:"ui-keyboard-always-open",noKeyboard:"ui-keyboard-nokeyboard",placeholder:"ui-keyboard-placeholder",hasFocus:"ui-keyboard-has-focus",isCurrent:"ui-keyboard-input-current",inputValid:"ui-keyboard-valid-input",inputInvalid:"ui-keyboard-invalid-input",inputAutoAccepted:"ui-keyboard-autoaccepted",endRow:"ui-keyboard-button-endrow"},t.events={kbChange:"keyboardChange",kbBeforeClose:"beforeClose",kbBeforeVisible:"beforeVisible",kbVisible:"visible",kbInit:"initialized",kbInactive:"inactive",kbHidden:"hidden",kbRepeater:"repeater",kbKeysetChange:"keysetChange",inputAccepted:"accepted",inputCanceled:"canceled",inputChange:"change",inputRestricted:"restricted"},t.keyaction={accept:function(e){return e.close(!0),!1},alt:function(e){e.altActive=!e.altActive,e.showSet()},bksp:function(e){e.insertText("\b")},cancel:function(e){return e.close(),!1},clear:function(e){e.$preview.val(""),e.$decBtn.length&&e.checkDecimal()},combo:function(e){var a=e.options,i=!a.useCombos,s=e.$keyboard.find("."+t.css.keyPrefix+"combo");return a.useCombos=i,s.toggleClass(a.css.buttonActive,i).attr("title",s.attr("data-title")+" ("+a.display[i?"active":"disabled"]+")"),i&&e.checkCombos(),!1},dec:function(e){e.insertText(e.decimal?".":",")},del:function(e){e.insertText("{d}")},default:function(e){e.shiftActive=e.altActive=e.metaActive=!1,e.showSet()},enter:function(a,i,s){var n=a.el.nodeName,o=a.options;return s.shiftKey?o.enterNavigation?a.switchInput(!s[o.enterMod],!0):a.close(!0):o.enterNavigation&&("TEXTAREA"!==n||s[o.enterMod])?a.switchInput(!s[o.enterMod],!!o.autoAccept&&"true"):void("TEXTAREA"===n&&e(s.target).closest("button").length&&a.insertText((t.msie?" ":"")+"\n"))},lock:function(e){e.last.keyset[0]=e.shiftActive=e.capsLock=!e.capsLock,e.showSet()},left:function(e){var a=t.caret(e.$preview);a.start-1>=0&&(e.last.start=e.last.end=a.start-1,t.caret(e.$preview,e.last),e.setScroll())},meta:function(t,a){var i=e(a);t.metaActive=!i.hasClass(t.options.css.buttonActive),t.showSet(i.attr("data-name"))},next:function(e){return e.switchInput(!0,e.options.autoAccept),!1},normal:function(e){e.shiftActive=e.altActive=e.metaActive=!1,e.showSet()},prev:function(e){return e.switchInput(!1,e.options.autoAccept),!1},right:function(e){var a=t.caret(e.$preview);a.start+1<=e.$preview.val().length&&(e.last.start=e.last.end=a.start+1,t.caret(e.$preview,e.last),e.setScroll())},shift:function(e){e.last.keyset[0]=e.shiftActive=!e.shiftActive,e.showSet()},sign:function(e){/^\-?\d*\.?\d*$/.test(e.$preview.val())&&e.$preview.val(e.$preview.val()*-1)},space:function(e){e.insertText(" ")},tab:function(e){var t=e.el.nodeName,a=e.options;return"INPUT"===t?!!a.tabNavigation&&e.switchInput(!e.shiftActive,!0):void e.insertText("\t")},toggle:function(e){e.enabled=!e.enabled,
e.toggle()},NBSP:" ",ZWSP:"​",ZWNJ:"‌",ZWJ:"‍",LRM:"‎",RLM:"‏"},t.builtLayouts={},t.layouts={alpha:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ ¡ ² ³ ¤ € ¼ ½ ¾ ‘ ’ ¥ × {bksp}","{tab} ä å é ® þ ü ú í ó ö « » ¬","á ß ð f g h j k ø ¶ ´ {enter}","{shift} æ x © v b ñ µ ç > ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ ¹ ² ³ £ € ¼ ½ ¾ ‘ ’ ¥ ÷ {bksp}","{tab} Ä Å É ® Þ Ü Ú Í Ó Ö « » ¦","Ä § Ð F G H J K Ø ° ¨ {enter}","{shift} Æ X ¢ V B Ñ µ Ç . ¿ {shift}","{accept} {alt} {space} {alt} {cancel}"]},colemak:{normal:["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w f p g j l u y ; [ ] \\","{bksp} a r s t d h n e i o ' {enter}","{shift} z x c v b k m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W F P G J L U Y : { } |",'{bksp} A R S T D H N E I O " {enter}',"{shift} Z X C V B K M < > ? {shift}","{accept} {space} {cancel}"]},dvorak:{normal:["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{normal:["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 {dec} {a} {c}"]}},t.language={en:{display:{a:"✔:Accept (Shift+Enter)",accept:"Accept:Accept (Shift+Enter)",alt:"Alt:⌥ AltGr",b:"⌫:Backspace",bksp:"Bksp:Backspace",c:"✖:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"ö:Toggle Combo Keys",dec:".:Decimal",e:"⏎:Enter",empty:" ",enter:"Enter:Enter ⏎",left:"←",lock:"Lock:⇪ Caps Lock",next:"Next ⇨",prev:"⇦ Prev",right:"→",s:"⇧:Shift",shift:"Shift:Shift",sign:"±:Change Sign",space:" :Space",t:"⇥:Tab",tab:"⇥ Tab:Tab",toggle:" ",valid:"valid",invalid:"invalid",active:"active",disabled:"disabled"},wheelMessage:"Use mousewheel to see other keys",comboRegex:/([`\'~\^\"ao])([a-z])/gim,combos:{"`":{a:"à",A:"À",e:"è",E:"È",i:"ì",I:"Ì",o:"ò",O:"Ò",u:"ù",U:"Ù",y:"ỳ",Y:"Ỳ"},"'":{a:"á",A:"Á",e:"é",E:"É",i:"í",I:"Í",o:"ó",O:"Ó",u:"ú",U:"Ú",y:"ý",Y:"Ý"},'"':{a:"ä",A:"Ä",e:"ë",E:"Ë",i:"ï",I:"Ï",o:"ö",O:"Ö",u:"ü",U:"Ü",y:"ÿ",Y:"Ÿ"},"^":{a:"â",A:"Â",e:"ê",E:"Ê",i:"î",I:"Î",o:"ô",O:"Ô",u:"û",U:"Û",y:"ŷ",Y:"Ŷ"},"~":{a:"ã",A:"Ã",e:"ẽ",E:"Ẽ",i:"ĩ",I:"Ĩ",o:"õ",O:"Õ",u:"ũ",U:"Ũ",y:"ỹ",Y:"Ỹ",n:"ñ",N:"Ñ"}}}},t.defaultOptions={language:null,rtl:!1,layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},reposition:!0,usePreview:!0,alwaysOpen:!1,initialFocus:!0,noFocus:!1,stayOpen:!1,ignoreEsc:!1,css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",popup:"",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonActive:"ui-state-active",buttonDisabled:"ui-state-disabled",buttonEmpty:"ui-keyboard-empty"},autoAccept:!1,autoAcceptOnEsc:!1,lockInput:!1,restrictInput:!1,restrictInclude:"",acceptValid:!1,cancelClose:!0,tabNavigation:!1,enterNavigation:!1,enterMod:"altKey",stopAtEnd:!0,appendLocally:!1,appendTo:"body",stickyShift:!0,preventPaste:!1,caretToEnd:!1,scrollAdjustment:10,maxLength:!1,maxInsert:!0,repeatDelay:500,repeatRate:20,resetDefault:!0,openOn:"focus",keyBinding:"mousedown touchstart",useWheel:!0,useCombos:!0,validate:function(e,t,a){return!0}},t.comboRegex=/([`\'~\^\"ao])([a-z])/gim,t.currentKeyboard="",e('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");</script><![endif]--><!--[if IE]><script>jQuery("body").addClass("ie");</script><![endif]-->').appendTo("body").remove(),t.msie=e("body").hasClass("oldie"),t.allie=e("body").hasClass("ie"),t.watermark="undefined"!=typeof document.createElement("input").placeholder,t.checkCaretSupport=function(){if("boolean"!=typeof t.checkCaret){var a=e('<div style="height:0px;width:0px;overflow:hidden;position:fixed;top:0;left:-100px;"><input type="text" value="testing"/></div>').prependTo("body");t.caret(a.find("input"),3,3),t.checkCaret=3!==t.caret(a.find("input").hide().show()).start,a.remove()}return t.checkCaret},t.caret=function(e,t,a){if(!e||!e.length||e.is(":hidden")||"hidden"===e.css("visibility"))return{};var i,s,n,o,r=e.data("keyboard"),l=r&&r.options.noFocus;return l||e.focus(),"undefined"!=typeof t?("object"==typeof t&&"start"in t&&"end"in t?(i=t.start,s=t.end):"undefined"==typeof a&&(a=t),"number"==typeof t&&"number"==typeof a?(i=t,s=a):"start"===t?i=s=0:"string"==typeof t&&(i=s=e.val().length),e.caret(i,s,l)):(o=e.caret(),i=o.start,s=o.end,n=e[0].value||e.text()||"",{start:i,end:s,text:n.substring(i,s),replaceStr:function(e){return n.substring(0,i)+e+n.substring(s,n.length)}})},e.fn.keyboard=function(t){return this.each(function(){e(this).data("keyboard")||new e.keyboard(this,t)})},e.fn.getkeyboard=function(){return this.data("keyboard")},e.fn.caret=function(e,t,a){if("undefined"==typeof this[0]||this.is(":hidden")||"hidden"===this.css("visibility"))return this;var i,s,n,o,r,l=document.selection,c=this,d=c[0],p=d.scrollTop,u=!1,y=!0;try{u="selectionStart"in d}catch(e){y=!1}return y&&"undefined"!=typeof e?(/(email|number)/i.test(d.type)||(u?(d.selectionStart=e,d.selectionEnd=t):(i=d.createTextRange(),i.collapse(!0),i.moveStart("character",e),i.moveEnd("character",t-e),i.select())),a||!c.is(":visible")&&"hidden"===c.css("visibility")||d.focus(),d.scrollTop=p,this):(/(email|number)/i.test(d.type)?e=t=c.val().length:u?(e=d.selectionStart,t=d.selectionEnd):l?"TEXTAREA"===d.nodeName?(r=c.val(),s=l.createRange(),n=s.duplicate(),n.moveToElementText(d),n.setEndPoint("EndToEnd",s),e=n.text.replace(/\r/g,"\n").length,t=e+s.text.replace(/\r/g,"\n").length):(r=c.val().replace(/\r/g,"\n"),s=l.createRange().duplicate(),s.moveEnd("character",r.length),e=""===s.text?r.length:r.lastIndexOf(s.text),s=l.createRange().duplicate(),s.moveStart("character",-r.length),t=s.text.length):e=t=(d.value||"").length,o=d.value||"",{start:e,end:t,text:o.substring(e,t),replace:function(a){return o.substring(0,e)+a+o.substring(t,o.length)}})},t});